<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Elite English Pro Â· Definitivo</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700;900&display=swap" rel="stylesheet">

<style>
:root{
--bg:#050812;--card:#12183a;--card2:#0b0f2e;--glass:#ffffff12;
--text:#f4f6ff;--muted:#aab3d9;--brand:#7b7cff;--brand2:#35e3ff;
--gold:#ffd479;--ok:#2bff88;--bad:#ff5a5a;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter;color:var(--text);background:radial-gradient(1200px 700px at 50% -300px,#1c2570,#050812);padding-bottom:110px}
header{padding:18px;font-family:Outfit;font-weight:900;text-align:center;background:#050812dd;backdrop-filter:blur(24px);position:sticky;top:0;z-index:10}
.container{max-width:900px;margin:auto;padding:24px}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border-radius:28px;padding:26px;margin-bottom:28px;box-shadow:0 40px 120px rgba(0,0,0,.65)}
.badge{font-size:.7rem;font-weight:900;letter-spacing:.12em;color:#bcd1ff;margin-bottom:12px}
.text-en{font-family:Outfit;font-size:1.6rem;line-height:1.3}
.text-es{color:var(--muted);margin-top:10px}
.text-fig{font-family:monospace;color:var(--gold);background:#0008;padding:14px;border-radius:14px;margin-top:12px}
.controls{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
.btn-icon{width:48px;height:48px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;font-size:1.1rem;cursor:pointer;transition:transform .15s}
.btn-icon:hover{transform:scale(1.1)}
.btn-main{width:100%;padding:16px;border:none;border-radius:22px;background:linear-gradient(135deg,var(--brand),var(--brand2));font-family:Outfit;font-weight:900;color:#fff;margin-top:18px;cursor:pointer;transition:transform .15s}
.btn-main:hover{transform:scale(1.03)}
.tab{display:none}.tab.active{display:block}
.option{background:#ffffff14;padding:14px;border-radius:14px;margin-top:10px;cursor:pointer;}
.correct{background:#2bff8830}.wrong{background:#ff5a5a40}
nav{position:fixed;bottom:0;left:0;right:0;height:88px;background:#050812f2;backdrop-filter:blur(30px);display:flex;justify-content:space-around;align-items:center}
nav div{display:flex;flex-direction:column;align-items:center;gap:6px;font-size:.65rem;font-weight:900;color:#9aa3d0;cursor:pointer}
nav i{font-size:1.5rem}
nav .active{color:var(--brand2);transform:translateY(-4px)}
textarea,input,select{width:100%;border:none;border-radius:14px;padding:14px;background:#0007;color:#fff}
textarea{min-height:140px;resize:none}
</style>
</head>
<body>

<header>ELITE ENGLISH PRO</header>

<div class="container">

<!-- FRASES -->
<section id="phrases" class="tab active">
<div class="card">
<div class="badge">PHRASES</div>
<div id="phEn" class="text-en"></div>
<div id="phFig" class="text-fig"></div>
<div id="phEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(phEn.innerText,'en',1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="tts(phEn.innerText,'en',0.6)"><i class="fas fa-snail"></i></button>
<button class="btn-icon" onclick="duo(phEn.innerText,phEs.innerText)"><i class="fas fa-globe"></i></button>
</div>
<button class="btn-main" onclick="loadPhrase()">NEW PHRASE</button>
</div>
</section>

<!-- HISTORIAS -->
<section id="stories" class="tab">
<div class="card">
<div class="badge">STORIES</div>
<div id="stEn" class="text-en"></div>
<div id="stFig" class="text-fig"></div>
<div id="stEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(stEn.innerText,'en',1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="tts(stEn.innerText,'en',0.6)"><i class="fas fa-snail"></i></button>
<button class="btn-icon" onclick="duo(stEn.innerText,stEs.innerText)"><i class="fas fa-globe"></i></button>
</div>
<button class="btn-main" onclick="loadStory()">NEW STORY</button>
</div>
</section>

<!-- SPEAK -->
<section id="speak" class="tab">
<div class="card">
<div class="badge">SPEAK</div>
<div id="spTarget" class="text-en"></div>
<div id="spFig" class="text-fig"></div>
<div id="spEs" class="text-es"></div>
<div class="controls">
<button class="btn-icon" onclick="tts(spTarget.innerText,'en',1)"><i class="fas fa-play"></i></button>
<button class="btn-icon" onclick="startSpeak()"><i class="fas fa-microphone"></i></button>
</div>
<div id="spResult"></div>
<button class="btn-main" onclick="generateSpeak()">NEW PHRASE</button>
</div>
</section>

<!-- EXERCISES -->
<section id="exercises" class="tab">
<div class="card">
<div class="badge">EXERCISES</div>
<div id="exQ" class="text-en"></div>
<div id="exOpts"></div>
<button class="btn-main" onclick="loadExercise()">NEW EXERCISE</button>
</div>
</section>

<!-- GLOBAL -->
<section id="global" class="tab">
<div class="card">
<div class="badge">GLOBAL Â· AI SETTINGS</div>
<input id="geminiKey" type="password" placeholder="Paste your Gemini API Key">
<select id="aiMode">
<option value="off">OFF (Fallback Internet + Local)</option>
<option value="gemini">GEMINI (Priority)</option>
</select>
<button class="btn-main" onclick="saveGlobal()">SAVE SETTINGS</button>
<div id="globalStatus" class="text-es"></div>
</div>
</section>

</div>

<nav>
<div class="active" onclick="tab('phrases',this)"><i class="fas fa-bolt"></i><span>PHRASES</span></div>
<div onclick="tab('stories',this)"><i class="fas fa-book"></i><span>STORIES</span></div>
<div onclick="tab('speak',this)"><i class="fas fa-microphone"></i><span>SPEAK</span></div>
<div onclick="tab('exercises',this)"><i class="fas fa-dumbbell"></i><span>EXERCISES</span></div>
<div onclick="tab('global',this)"><i class="fas fa-gear"></i><span>GLOBAL</span></div>
</nav>

<script>
// Helpers
const $=id=>document.getElementById(id);
const phEn=$("phEn"),phFig=$("phFig"),phEs=$("phEs");
const stEn=$("stEn"),stFig=$("stFig"),stEs=$("stEs");
const spTarget=$("spTarget"),spFig=$("spFig"),spEs=$("spEs"),spResult=$("spResult");
const exQ=$("exQ"),exOpts=$("exOpts");
const geminiKey=$("geminiKey"),aiMode=$("aiMode"),globalStatus=$("globalStatus");

// NAV
function tab(id,el){document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));$(id).classList.add("active");document.querySelectorAll("nav div").forEach(n=>n.classList.remove("active"));el.classList.add("active");}

// AUDIO
function tts(text,lang,rate){if(!text)return;const u=new SpeechSynthesisUtterance(text);u.lang=lang==="en"?"en-US":"es-ES";u.rate=rate;speechSynthesis.cancel();speechSynthesis.speak(u);}
function duo(en,es){tts(en,"en",1);setTimeout(()=>tts(es,"es",1),1200);}
function figEN(t){return t.toLowerCase().replace(/th/g,"d").replace(/ph/g,"f").replace(/ing\b/g,"in");}

// Gemini API
async function gemini(prompt){
const key=localStorage.getItem("GEMINI_KEY");
if(!key)throw 0;
const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`,{
method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})});
const d=await r.json();
return d.candidates?.[0]?.content?.parts?.[0]?.text;
}

// Translate
async function translate(t){try{const r=await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(t)}&langpair=en|es`);return(await r.json()).responseData.translatedText;}catch{return t;}}

// FRASES
async function loadPhrase(){try{if(aiMode.value==="gemini"){const g=await gemini("Give a short motivational English phrase");if(g)return renderPhrase(g);}throw 0;}catch{try{const r=await fetch("https://api.adviceslip.com/advice");renderPhrase((await r.json()).slip.advice);}catch{const local=["Practice makes perfect.","Consistency is key.","Learning never stops."];renderPhrase(local[Math.floor(Math.random()*local.length)]);}}}
async function renderPhrase(t){phEn.innerText=t;phFig.innerText=figEN(t);phEs.innerText=await translate(t);}

// HISTORIAS
async function loadStory(){try{if(aiMode.value==="gemini"){const g=await gemini("Generate a short English story for learning English, 2-3 sentences.");if(g)return renderStory(g);throw 0;}const r=await fetch("https://en.wikipedia.org/api/rest_v1/page/random/summary");const d=await r.json();if(d.extract)renderStory(d.extract);else throw 0;}catch{const localStories=["John loves to play football every weekend.","Maria goes to the library to read interesting books.","The cat jumped over the fence and ran away."];renderStory(localStories[Math.floor(Math.random()*localStories.length)]);}}
async function renderStory(t){stEn.innerText=t;stFig.innerText=figEN(t);stEs.innerText=await translate(t);}

// SPEAK
let recognition=null;
function startSpeak(){const SR=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SR){spResult.innerText="âŒ Navegador no soporta Speech";return;}if(recognition){recognition.stop();recognition=null;spResult.innerText="ðŸ›‘ GrabaciÃ³n detenida";return;}recognition=new SR();recognition.lang="en-US";recognition.interimResults=false;recognition.maxAlternatives=1;spResult.innerText="ðŸŽ™ï¸ Grabando...";recognition.onresult=e=>spResult.innerText="ðŸ—£ï¸ "+e.results[0][0].transcript;recognition.onerror=e=>{spResult.innerText="âŒ Mic error: "+e.error;recognition=null;};recognition.onend=()=>recognition=null;recognition.start();}
async function generateSpeak(){try{if(aiMode.value==="gemini"){const g=await gemini("Give a short English sentence for pronunciation");if(g)return renderSpeak(g);}throw 0;}catch{try{const r=await fetch("https://api.adviceslip.com/advice");renderSpeak((await r.json()).slip.advice);}catch{const local=["Practice makes perfect.","Consistency is key.","Learning never stops."];renderSpeak(local[Math.floor(Math.random()*local.length)]);}}}
async function renderSpeak(t){spTarget.innerText=t;spFig.innerText=figEN(t);spEs.innerText=await translate(t);spResult.innerText="";}

// EJERCICIOS
const localExercises=[{q:"She ___ English every day.",opts:["study","studies","studying"],correct:1},{q:"I ___ to the gym yesterday.",opts:["go","went","gone"],correct:1},{q:"He usually ___ breakfast at 7am.",opts:["eat","eats","eating"],correct:1},{q:"They ___ playing soccer now.",opts:["is","are","am"],correct:1}];
async function loadExercise(){exQ.innerText=""; exOpts.innerHTML="";try{if(aiMode.value==="gemini"){const g=await gemini("Create a simple English grammar exercise: 1 question and 3 options, mark the correct with *");if(g){renderExerciseFromText(g);return;}throw "fallback";}const r=await fetch("https://opentdb.com/api.php?amount=1&type=multiple&encode=url3986");const data=await r.json();if(data.results && data.results.length>0){const q=data.results[0];const question=decodeURIComponent(q.question);const correct_answer=decodeURIComponent(q.correct_answer);const incorrect_answers=q.incorrect_answers.map(a=>decodeURIComponent(a));renderExercise(question,[...incorrect_answers,correct_answer],correct_answer);return;}throw "fallback";}catch{const e=localExercises[Math.floor(Math.random()*localExercises.length)];renderExercise(e.q,e.opts,e.opts[e.correct]);}}
function renderExerciseFromText(text){const lines=text.split("\n").filter(l=>l.trim());if(lines.length<4){loadExercise();return;}const question=lines[0].replace(/^Q:\s*/,"");const options=lines.slice(1,4).map(o=>o.replace(/^\-\s*/,"").replace("*",""));const correct=lines.slice(1,4).find(o=>o.includes("*"))?.replace("*","")||options[0];renderExercise(question,options,correct);}
function renderExercise(question,options,correct){exQ.innerText=question; exOpts.innerHTML=""; options.sort(()=>Math.random()-0.5).forEach(o=>{let div=document.createElement("div");div.className="option";div.innerText=o;div.onclick=()=>div.classList.add(o===correct?"correct":"wrong");exOpts.appendChild(div);});}

// GLOBAL
function saveGlobal(){localStorage.setItem("GEMINI_KEY",geminiKey.value);localStorage.setItem("AI_MODE",aiMode.value);globalStatus.innerText="âœ… Guardado";}

// INIT
(function(){geminiKey.value=localStorage.getItem("GEMINI_KEY")||""; aiMode.value=localStorage.getItem("AI_MODE")||"off"; loadPhrase(); generateSpeak(); loadExercise(); loadStory();})();
</script>
<script>
/* ==================== CONFIG ==================== */
const trInput = document.getElementById("trInput");
const trOutput = document.getElementById("trOutput");
const trFig = document.getElementById("trFig");
const trDir = {value:"en-es"}; // formato: "en-es"

/* ==================== TRADUCCIÃ“N SMART CON MÃšLTIPLES OPCIONES ==================== */
async function doTranslate(){
    const [from,to] = trDir.value.split("-");
    trOutput.innerText = "Translating...";
    trOutput.innerText = await translateMultiFallback(trInput.value, from, to);
    trFig.innerText = to==="es" ? figSpanish(trOutput.innerText) : "";
}

// FunciÃ³n principal con varios traductores
async function translateMultiFallback(text, from, to){
    const translators = [
        translateApertium,
        translateMyMemory,
        translateLibre,
        translateDeepLDemo,
        translateLocal
    ];
    
    for(const tr of translators){
        try{
            const result = await tr(text, from, to);
            if(result && result.trim()!=="") return result;
        }catch(e){console.warn(tr.name+" failed", e);}
    }
    
    return "[Translation unavailable]";
}

/* ==================== TRADUCTORES ==================== */

// 1. Apertium
async function translateApertium(text, from, to){
    const r = await fetch(`https://apertium.org/apy/translate?langpair=${from}|${to}&q=${encodeURIComponent(text)}`);
    const d = await r.json();
    return d.responseData?.translatedText || "";
}

// 2. MyMemory
async function translateMyMemory(text, from, to){
    const r = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}`);
    const d = await r.json();
    return d.responseData?.translatedText || "";
}

// 3. LibreTranslate
async function translateLibre(text, from, to){
    const r = await fetch("https://libretranslate.com/translate",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({q:text,source:from,target:to,format:"text"})
    });
    const d = await r.json();
    return d.translatedText || "";
}

// 4. DeepL Demo
async function translateDeepLDemo(text, from, to){
    // Usamos demo pÃºblica de DeepL (solo para testing, puede fallar)
    const r = await fetch(`https://www2.deepl.com/jsonrpc?method=LMT_handle_jobs`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({jsonrpc:"2.0",method:"LMT_handle_jobs",params:{jobs:[{kind:"default",raw_en_sentence:text}],lang:{source_lang:from.toUpperCase(),target_lang:to.toUpperCase()}},id:1})
    });
    const d = await r.json();
    return d.result?.translations?.[0]?.beams?.[0]?.postprocessed_sentence || "";
}

// 5. Fallback local
async function translateLocal(text, from, to){
    return `[LOCAL TRANSLATION UNAVAILABLE] ${text}`;
}

/* ==================== PRONUNCIACIÃ“N FIGURADA AL ESPAÃ‘OL ==================== */
function figSpanish(text){
    let t = text.toLowerCase();

    // reemplazos fonÃ©ticos
    t = t.replace(/ph/g,"f").replace(/th/g,"z").replace(/ch/g,"ch");
    t = t.replace(/sh/g,"sh").replace(/ck/g,"k").replace(/gh/g,"g");
    t = t.replace(/tion\b/g,"shon").replace(/sion\b/g,"shon").replace(/cial\b/g,"shal").replace(/tial\b/g,"shal");
    t = t.replace(/ing\b/g,"in").replace(/ed\b/g,"d").replace(/ly\b/g,"li").replace(/ous\b/g,"os");
    t = t.replace(/ee|ea/g,"i").replace(/ie|igh/g,"ai").replace(/ai|ay/g,"ei").replace(/oa/g,"ou").replace(/ow|ou/g,"au").replace(/oo/g,"u");

    t = t.replace(/\b([bcdfghjklmnpqrstvwxyz]*)([aeiou]+)([bcdfghjklmnpqrstvwxyz]*)\b/g,
        (match,prefix,vowel,suffix)=>`${prefix}${vowel}${suffix}`);
    
    t = t.replace(/[^a-zÃ¡Ã©Ã­Ã³ÃºÃ±\s]/gi,"");
    t = t.replace(/\s+/g," ").trim();
    return t;
}

/* ==================== EJEMPLO DE USO ==================== */
async function testTranslate(){
    trInput.value = "Hello, how are you?";
    await doTranslate();
    console.log("Traducido:", trOutput.innerText);
    console.log("Figurado:", trFig.innerText);
}

// testTranslate(); // Descomenta para probar
</script>
</body>
</html>
